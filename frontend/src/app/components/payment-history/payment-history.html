<div class="payment-history-container">
  <div class="card">
    <div class="card-header">
      <h3>Payment History</h3>
      <button class="btn btn-sm btn-outline-primary" (click)="loadPaymentHistory()">
        Refresh
      </button>
    </div>

    <div *ngIf="error" class="alert alert-danger" role="alert">
      {{ error }}
    </div>

    <div *ngIf="loading" class="text-center p-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading payment history...</p>
    </div>

    <div *ngIf="!loading && payments.length === 0" class="alert alert-info">
      No payments found.
    </div>

    <div *ngIf="!loading && payments.length > 0" class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Date</th>
            <th>Amount</th>
            <th>Currency</th>
            <th>Status</th>
            <th>Gateway</th>
            <th>Customer ID</th>
            <th>Report ID</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let payment of payments">
            <td>{{ formatDate(payment.createdAt) }}</td>
            <td><strong>${{ payment.amount.toFixed(2) }}</strong></td>
            <td>{{ payment.currency }}</td>
            <td>
              <span class="badge" [ngClass]="'bg-' + getStatusBadge(payment.status)">
                {{ payment.status | uppercase }}
              </span>
            </td>
            <td>{{ payment.id.substring(0, 10) }}...</td>
            <td>{{ payment.customerId }}</td>
            <td>{{ payment.reportId || 'N/A' }}</td>
            <td>
              <button 
                class="btn btn-sm btn-danger"
                (click)="refundPayment(payment.id, payment.amount)"
                [disabled]="payment.status !== 'completed'"
                title="Refund payment"
              >
                Refund
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
